(()=>{var e={264:(e,r,t)=>{const s=t(434);e.exports={createQuery:e=>{s.createQuery(e)},parseQuery:e=>s.searchToQuery(e),postQuery:async e=>{const r=await s.postQuery(e.variables);r.data.data.axies.results.length>0&&s.checkResponse(e.maxPrice,r.data.data.axies)},getAllQueries:()=>s.getAllQueries(),getQueryById:e=>s.getQueryById(e),deleteQueryById:e=>{s.deleteQueryById(e)}}},871:(e,r,t)=>{const s=t(30);e.exports={createNewSearch:e=>{s.createNewSearch(e)},getAllSearches:(e,r)=>s.getAllSearches(),getSearchById:e=>s.getSearchById(e),deleteSearchById:e=>{s.deleteSearchById(e)}}},95:(e,r,t)=>{const s=t(185),a=t(294),n=t(339),c=t(70);s.connect("mongodb://localhost:27017/AxieBot?&authSource=admin",{useNewUrlParser:!0}),e.exports={createNewSearch:e=>{e.save()},getAllSearches:(e,r)=>a.find(),getSearchById:e=>a.findById(e),deleteSearchById:e=>{a.findByIdAndDelete(e)},newQuery:(e,r)=>{e.save()},getAllQueries:async(e,r)=>await n.find(),getQueryById:e=>n.findById(e),deleteQueryById:e=>{n.findByIdAndDelete(e)},newHit:(e,r)=>{e.save()},checkIfIdExists:e=>null!==c.exists({_id:e})}},788:(e,r,t)=>{t(185);const s=t(95),a=t(70);e.exports={createHit:(e,r)=>{const t=new a(e);s.newHit(t)},checkIfIdExists:e=>s.checkIfIdExists(e)}},136:(e,r,t)=>{t(185);const s=t(95),a=t(339);e.exports={createQuery:(e,r)=>{const t=new a(e);s.newQuery(t)},deleteQueryById:e=>{s.deleteQueryById(e)},getAllQueries:(e,r)=>s.getAllQueries(),getQueryById:e=>s.getQueryById(e)}},932:(e,r,t)=>{t(185);const s=t(95),a=t(294);e.exports={createNewSearch:e=>{const r=new a(e);s.createNewSearch(r)},getAllSearches:(e,r)=>s.getAllSearches(),getSearchById:e=>s.getSearchById(e),deleteSearchById:e=>{s.deleteSearchById(e)}}},70:(e,r,t)=>{const s=t(185),a=new s.Schema({name:String,class:String},{_id:!1}),n=new s.Schema({_id:Number,searchName:String,classes:String,eye:a,ear:a,back:a,mouth:a,horn:a,tail:a,breedCount:Number,price:Number});e.exports=s.model("Hit",n)},339:(e,r,t)=>{const s=t(185),a=new s.Schema({classes:String,parts:Array,breedCount:Number},{_id:!1}),n=new s.Schema({auctionType:String,sort:String,criteria:a},{_id:!1}),c=new s.Schema({operationName:String,variables:n,query:String},{_id:!1}),i=new s.Schema({searchName:String,maxPrice:Number,query:c});e.exports=s.model("query",i)},294:(e,r,t)=>{const s=t(185),a=new s.Schema({searchName:String,classes:String,eye:String,ear:String,back:String,mouth:String,horn:String,tail:String,breedCount:Number,maxPrice:Number});e.exports=s.model("Search",a)},663:(e,r,t)=>{const s=t(788);e.exports={createHit:e=>{if(console.log(e.id),!s.checkIfIdExists(e.id)){const r=(e=>({_id:e.id,searchName:e.searchName,classes:e.class,eye:{name:e.parts[0].name,class:e.parts[0].class},ear:{name:e.parts[1].name,class:e.parts[1].class},back:{name:e.parts[2].name,class:e.parts[2].class},mouth:{name:e.parts[3].name,class:e.parts[3].class},horn:{name:e.parts[4].name,class:e.parts[4].class},tail:{name:e.parts[5].name,class:e.parts[5].class},breedCount:e.breedCount,price:e.auction.currentPrice/1e18}))(e);s.createHit(r)}}}},434:(e,r,t)=>{t(185);const s=t(167),a=t(136),n=t(663),c=(e,r)=>{if(e){const t=h("eye",y(e));r.push(t)}},i=(e,r)=>{if(e){const t=h("ears",y(e));r.push(t)}},o=(e,r)=>{if(e){const t=h("back",y(e));r.push(t)}},u=(e,r)=>{if(e){const t=h("mouth",y(e));r.push(t)}},l=(e,r)=>{if(e){const t=h("horn",y(e));r.push(t)}},d=(e,r)=>{if(e){const t=h("tail",y(e));r.push(t)}},y=e=>{for(let r=0;r<e.length;r++)if(" "===e.charAt(r))return e.substring(0,r)+"-"+e.substring(r+1);return e};function h(e,r){return e+"-"+r}e.exports={searchToQuery:e=>{const r=e.searchName,t=e.maxPrice,s=(e=>{let r=[];return c(e.eye,r),i(e.ear,r),o(e.back,r),u(e.mouth,r),l(e.horn,r),d(e.tail,r),r})(e);return((e,r,t,s)=>({searchName:s,maxPrice:t,variables:{operationName:"GetAxieBriefList",variables:{auctionType:"Sale",sort:"PriceAsc",criteria:{...e.classes&&{classes:e.classes},...e.breedCount&&{breedCount:e.breedCount},parts:r}},query:"query GetAxieBriefList($auctionType: AuctionType, $criteria: AxieSearchCriteria, $sort: SortBy) {\n  axies(auctionType: $auctionType, criteria: $criteria, sort: $sort) {\n    total\n    results {\n      ...AxieBrief\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment AxieBrief on Axie {\n  id\n  class\n  breedCount\n  image\n  battleInfo {\n    banned\n    __typename\n  }\n  auction {\n    currentPrice\n    currentPriceUSD\n    __typename\n  }\n  parts {\n    id\n    name\n    class\n    type\n    specialGenes\n    __typename\n  }\n  __typename\n}\n"}}))(e,s,t,r)},createQuery:e=>{a.createQuery(e)},postQuery:async function(e){console.log(e),url="https://graphql-gateway.axieinfinity.com/graphql";try{const r=await s.post(url,e);if(200===r.status)return r}catch(e){console.error(e.response.data)}},checkResponse:function(e,r){for(let t=0;t<r.results.length;t++){const s=r.results[t].auction.currentPrice/1e18;if(s<=e&&(console.log("hit"),n.createHit(r.results[t])),s>e)return}},getAllQueries:()=>a.getAllQueries(),getQueryById:e=>a.getQueryById(e),deleteQueryById:e=>{a.deleteQueryById(e)}}},30:(e,r,t)=>{const s=t(932);e.exports={createNewSearch:e=>{s.createNewSearch(e)},getAllSearches:(e,r)=>s.getAllSearches(),getSearchById:e=>s.getSearchById(e),deleteSearchById:e=>{s.deleteSearchById(e)}}},167:e=>{"use strict";e.exports=require("axios")},986:e=>{"use strict";e.exports=require("body-parser")},860:e=>{"use strict";e.exports=require("express")},185:e=>{"use strict";e.exports=require("mongoose")}},r={};function t(s){var a=r[s];if(void 0!==a)return a.exports;var n=r[s]={exports:{}};return e[s](n,n.exports,t),n.exports}(()=>{const e=t(860),r=t(986),s=t(871),a=t(264),n=(t(434),e());n.set("view engine","ejs"),n.set("views","./views"),n.use(e.static("public")),n.use(r.json()),r.json(),r.urlencoded({extended:!1}),n.listen(3e3,((e,r)=>{console.log("Listening on Port 3000")})),n.get("/",(async(e,r)=>{r.render("home",{})})),n.get("/api/searches",((e,r)=>{s.getAllSearches()})),n.get("/api/searches/:searchId",((e,r)=>{s.getSearchById(e.params.searchId)})),n.post("/api/searches",((e,r)=>{s.createNewSearch(e.body.searchCriteria);const t=a.parseQuery(e.body.searchCriteria);a.createQuery(t),a.postQuery(t)})),n.delete("/api/searches/:searchId",((e,r)=>{s.deleteSearchById(e.params.searchId)})),n.get("/api/queries",(async(e,r)=>{const t=await a.getAllQueries();console.log("server:"+t),r.send(t)})),n.get("/api/queries/:queryId",((e,r)=>{a.getQueryById(e.params.queryId)})),n.delete("/api/queries/:queryId",((e,r)=>{a.deleteQueryById(e.params.queryId)}))})()})();